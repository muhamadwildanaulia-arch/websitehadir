<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Aplikasi Kehadiran Guru SDN Muhara</title>

  <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/chart.js@3.9.1/dist/chart.min.js"></script>

  <style>
    :root{--bg:#f4f6f9;--text:#1f2937;--card:#fff;--primary:#1e3a8a}
    body{background:var(--bg);color:var(--text);font-family:Inter,ui-sans-serif,system-ui,-apple-system,"Segoe UI",Roboto,"Helvetica Neue",Arial;}
    .elev{background:var(--card);border-radius:.75rem;padding:1rem;box-shadow:0 8px 18px rgba(0,0,0,.06);}
    .avatar{width:2rem;height:2rem;border-radius:9999px;display:inline-flex;align-items:center;justify-content:center;color:#fff;font-weight:700;margin-right:.5rem}
    .name-cell{display:inline-flex;align-items:center}
    .banner{padding:.6rem 1rem;border-radius:.5rem;margin-bottom:.6rem}
    .banner-warn{background:#FEF3C7;border-left:4px solid #F59E0B;color:#92400E}
    .banner-danger{background:#FEE2E2;border-left:4px solid #EF4444;color:#991B1B}
    .badge{padding:.2rem .5rem;border-radius:999px;font-size:.8rem}
    #dailyChart{max-height:220px}
    /* small helpers */
    .muted{opacity:.8}
    .hidden{display:none}
  </style>
</head>
<body>

  <!-- HEADER -->
  <header class="elev flex items-center justify-between" style="margin:1rem">
    <div class="flex items-center gap-3">
      <img src="SD_Negeri_Muhara.png" alt="Logo" style="height:56px;border-radius:8px;background:#fff;padding:4px">
      <div>
        <h1 style="font-weight:700;color:var(--primary);margin:0">Aplikasi Kehadiran Guru SDN Muhara</h1>
        <div id="current-date" class="muted" style="font-size:13px"></div>
      </div>
    </div>
    <div class="flex items-center gap-2">
      <label style="display:inline-flex;align-items:center;background:#1e40af;color:#fff;padding:.45rem .6rem;border-radius:8px;cursor:pointer">
        <input id="eco-toggle" type="checkbox" style="margin-right:.5rem">Mode Hemat
      </label>
      <canvas id="analogClock" width="70" height="70" style="background:#fff;border-radius:999px;"></canvas>
    </div>
  </header>

  <main style="max-width:980px;margin:0 auto;padding:1rem;">

    <!-- banners -->
    <div id="already-banner" class="banner banner-warn hidden">⚠️ Guru ini <strong>sudah absen hari ini</strong>. Pengisian kedua tidak diperbolehkan.</div>
    <div id="late-banner" class="banner banner-danger hidden">⏰ <strong>Terlambat</strong>: Anda mengisi setelah batas 07:30. <span id="late-minutes"></span></div>
    <div id="distance-banner" class="banner hidden" style="background:#DBEAFE;border-left:4px solid #3B82F6;color:#1E3A8A"><span id="distance-text">Menghitung jarak...</span></div>

    <!-- quick stats -->
    <section class="grid grid-cols-2 md:grid-cols-4 gap-4" style="margin-bottom:1rem">
      <div class="elev text-center"><div class="muted">Hadir</div><div id="stat-hadir" style="font-size:20px;font-weight:700">0</div></div>
      <div class="elev text-center"><div class="muted">Izin</div><div id="stat-izin" style="font-size:20px;font-weight:700">0</div></div>
      <div class="elev text-center"><div class="muted">Sakit</div><div id="stat-sakit" style="font-size:20px;font-weight:700">0</div></div>
      <div class="elev text-center"><div class="muted">Dinas Luar</div><div id="stat-dl" style="font-size:20px;font-weight:700">0</div></div>
    </section>

    <!-- form -->
    <section class="elev" style="margin-bottom:1rem">
      <h2 style="margin:0 0 .6rem 0;color:var(--primary)">Form Kehadiran Guru</h2>
      <form id="attendance-form" class="grid grid-cols-1 md:grid-cols-2 gap-3">
        <div>
          <label style="font-weight:600">Cari / Nama Guru</label>
          <input id="search-guru" type="text" placeholder="Cari nama guru..." class="w-full p-2 border rounded" style="margin-top:.4rem">
          <select id="nama-guru-kehadiran" class="w-full p-2 border rounded mt-2" required>
            <option value="">-- Pilih Guru --</option>
          </select>
          <div id="warn-sudah-absen" class="muted" style="margin-top:.35rem;font-size:13px"></div>
        </div>

        <div>
          <label style="font-weight:600">Status Kehadiran</label>
          <select id="status-kehadiran" class="w-full p-2 border rounded mt-2" required>
            <option value="Hadir">Hadir</option>
            <option value="Izin">Izin</option>
            <option value="Sakit">Sakit</option>
            <option value="Dinas Luar">Dinas Luar</option>
          </select>
          <div id="status-info" class="muted" style="margin-top:.35rem;font-size:13px">Pilih salah satu: Hadir / Izin / Sakit / Dinas Luar.</div>
        </div>

        <div class="md:col-span-2">
          <label style="font-weight:600">Keterangan Lokasi (otomatis)</label>
          <input id="keterangan-lokasi" class="w-full p-2 border rounded mt-2" readonly placeholder="Menentukan lokasi...">
          <div id="distance-info" class="muted" style="margin-top:.35rem;font-size:13px"></div>
        </div>

        <div class="md:col-span-2">
          <label style="font-weight:600">Foto Kehadiran (opsional, pratinjau lokal saja)</label>
          <input id="foto-kehadiran" type="file" accept="image/*" capture="environment" class="w-full p-2 border rounded mt-2">
          <div id="foto-preview-wrap" class="mt-2 hidden" style="display:flex;gap:10px;align-items:center">
            <img id="preview-foto" alt="preview" style="width:160px;max-height:160px;object-fit:cover;border-radius:6px;box-shadow:0 6px 18px rgba(0,0,0,.08)">
            <button id="hapus-foto" type="button" class="p-2 bg-gray-100 rounded">Hapus Foto</button>
          </div>
          <div class="muted" style="font-size:12px;margin-top:.4rem">Foto hanya untuk pratinjau di perangkat dan <strong>tidak</strong> dikirim ke server.</div>
        </div>

        <div class="md:col-span-2 text-center">
          <button type="submit" class="bg-blue-700 text-white px-6 py-2 rounded mt-2">Simpan Kehadiran</button>
        </div>
      </form>
    </section>

    <!-- chart -->
    <section class="elev" style="margin-bottom:1rem">
      <h3 style="margin:0 0 .6rem 0;color:var(--primary)">Komposisi Kehadiran Hari Ini</h3>
      <div style="height:220px"><canvas id="dailyChart" aria-label="Grafik Kehadiran"></canvas></div>
    </section>

    <!-- list -->
    <section class="elev">
      <h3 style="margin:0 0 .6rem 0;color:var(--primary)">Daftar Kehadiran Hari Ini</h3>
      <div style="overflow:auto">
        <table style="width:100%;border-collapse:collapse;font-size:14px">
          <thead style="background:#f3f4f6;position:sticky;top:0">
            <tr>
              <th style="padding:.6rem;border:1px solid #eef2f7">Nama Guru</th>
              <th style="padding:.6rem;border:1px solid #eef2f7">Status</th>
              <th style="padding:.6rem;border:1px solid #eef2f7">Jam</th>
              <th style="padding:.6rem;border:1px solid #eef2f7">Lokasi</th>
              <th style="padding:.6rem;border:1px solid #eef2f7">Tanggal</th>
            </tr>
          </thead>
          <tbody id="attendance-list"></tbody>
        </table>
      </div>
    </section>

  </main>

  <script src="app.js"></script>

  <script>
    // small initial UI setup
    (function(){
      const now = new Date();
      document.getElementById('current-date').textContent = now.toLocaleDateString('id-ID', { weekday:'long', year:'numeric', month:'long', day:'numeric' });
      document.getElementById('eco-toggle').addEventListener('change', e => {
        try { localStorage.setItem('ecoMode', e.target.checked ? '1' : '0'); document.body.classList.toggle('eco', e.target.checked); } catch(e){}
      });
      // foto preview handlers wired in app.js too but keep a fallback init
      document.getElementById('toggle-theme')?.addEventListener?.('click', ()=>document.documentElement.classList.toggle('dark'));
      // init clock (drawAnalogClock from app.js)
      window.addEventListener('load', ()=>{ if (typeof drawAnalogClock === 'function') drawAnalogClock(); });
    })();
  </script>
</body>
</html>